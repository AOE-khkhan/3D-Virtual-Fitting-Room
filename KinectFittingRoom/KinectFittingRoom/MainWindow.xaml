<Window x:Class="KinectFittingRoom.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:KinectFittingRoom.Converters"
        xmlns:buttons="clr-namespace:KinectFittingRoom.View.Buttons"
        xmlns:helpers="clr-namespace:KinectFittingRoom.View.Helpers"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"        
        xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        WindowState="Maximized"		
		WindowStyle="None"
        Title="Kinect Fitting Room"
        Height="768" Width="1366"
        DataContext="{Binding KinectViewModel, Source={StaticResource KinectViewModelLoader}}">
    <Window.Resources>
        <converters:ReducedValueConverter x:Key="ReducedValueConverter"/>
        <converters:BitmapToImageSourceConverter x:Key="BitmapToImageSourceConverter"/>
        <DataTemplate x:Key="ButtonTemplate">
            <buttons:KinectButton Width="200" Height="200" Margin="5">
                <Canvas>
                    <Image Source="{Binding Image}" 
                                           Width="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type buttons:KinectButton}}, Path=Width}"
                                           Height="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type buttons:KinectButton}}, Path=Height}"/>
                </Canvas>
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="HandCursorClickEvent">
                        <i:InvokeCommandAction Command="{Binding CategoryCommand}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </buttons:KinectButton>
        </DataTemplate>
    </Window.Resources>
    <!--Main Grid. Keeps all of the UI elements.-->
    <Grid Background="Black">
        <!--Image from the Kinect camera-->
        <Image Source="{Binding KinectService.KinectCameraImage}"
			   helpers:PropertiesObserver.Observe="True"
			   helpers:PropertiesObserver.ObservedWidth="{Binding KinectService.Width, Mode=OneWayToSource}"
			   helpers:PropertiesObserver.ObservedHeight="{Binding KinectService.Height, Mode=OneWayToSource}"/>
        <!--Canvas containing both button panels-->
        <Canvas Name="ButtonPanelsCanvas" Width="{Binding KinectService.Width}" Height="{Binding KinectService.Height}">
            <Canvas Name="LeftPanel"
                    Width="250" 
                    Height="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Canvas}}
                    , Path=ActualHeight, Converter={StaticResource ReducedValueConverter}, ConverterParameter=40}" 
                    Background="GhostWhite" 
                    Opacity="0.5" 
                    Margin="20"/>
            <!--StackPanel containing all the buttons with clothing categories-->
            <ItemsControl ItemsSource="{Binding ClothingCategories}" 
                          Width="{Binding ActualWidth, ElementName=LeftPanel}"
                          Height="{Binding ActualHeight, ElementName=LeftPanel}" 
                          Canvas.Left="{Binding (Canvas.Left), ElementName=LeftPanel}" 
                          Canvas.Top="{Binding (Canvas.Top), ElementName=LeftPanel}" 
                          Margin="{Binding Margin, ElementName=LeftPanel}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <buttons:KinectButton Width="200" Height="200" Margin="5">
                            <Canvas>
                                <Image Source="{Binding Image}" 
                                       Width="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type buttons:KinectButton}}, Path=Width}"
									   Height="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type buttons:KinectButton}}, Path=Height}"/>
                            </Canvas>
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="HandCursorClick">
                                    <i:InvokeCommandAction Command="{Binding CategoryCommand}"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </buttons:KinectButton>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
            <Canvas Name="RightPanel"
                    Width="250" 
                    Height="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Canvas}}
                    , Path=ActualHeight, Converter={StaticResource ReducedValueConverter}, ConverterParameter=40}" 
                    Background="GhostWhite" 
                    Opacity="0.5" 
					Canvas.Right="0"
                    Margin="20"/>
            <!--StackPanel containing all the buttons with clothes-->
            <ItemsControl ItemsSource="{Binding ClothingCategories}"
                          Width="{Binding ActualWidth, ElementName=RightPanel}"
                          Height="{Binding ActualHeight, ElementName=RightPanel}" 
                          Canvas.Right="{Binding (Canvas.Right), ElementName=RightPanel}" 
                          Canvas.Top="{Binding (Canvas.Top), ElementName=RightPanel}" 
                          Margin="{Binding Margin, ElementName=RightPanel}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <buttons:KinectButton Width="200" Height="200" Margin="5">
                            <Canvas>
                                <Image Source="{Binding Image}" 
                                       Width="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type buttons:KinectButton}}, Path=Width}"
									   Height="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type buttons:KinectButton}}, Path=Height}"/>
                            </Canvas>
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="HandCursorClick">
                                    <i:InvokeCommandAction Command="{Binding CategoryCommand}"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </buttons:KinectButton>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Canvas>
        <!--Hand Cursor canvas-->
        <Canvas Width="{Binding KinectService.Width}" Height="{Binding KinectService.Height}">
            <Canvas Name="HandCursor" Width="70" Height="70" Visibility="Collapsed">
                <Ellipse Width="{Binding RelativeSource={RelativeSource AncestorType=Canvas}, Path=ActualWidth}" 
                         Height="{Binding RelativeSource={RelativeSource AncestorType=Canvas}, Path=ActualHeight}" 
                         Fill="GhostWhite"
                         Opacity="0.5" 
                         Stroke="Black" 
                         StrokeThickness="2"/>
                <Image Source="/Resources/Images/Hand.png" Width="60" Height="60" Margin="5,5,5,5">
                </Image>
            </Canvas>
        </Canvas>
        <!--Grid containing Skeleton parts for debugging-->
        <ItemsControl ItemsSource="{Binding KinectService.SkeletonManager.SkeletonParts}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Grid Width="{Binding KinectService.Width}" Height="{Binding KinectService.Height}"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
        </ItemsControl>
        <Canvas Background="Brown" Opacity="0.8" Width="100" Height="100" Margin="0,0,417,220" >
            <Label x:Name="TimerLabel" FontSize="30" x:FieldModifier="public" Width="100" Height="100" Margin="0,0,417,220" />
        </Canvas>
    </Grid>
</Window>
